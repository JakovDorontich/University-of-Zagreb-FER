<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1250">
<meta name=ProgId content=FrontPage.Editor.Document>
<meta name=Generator content="Microsoft FrontPage 6.0">
<meta name=Originator content="Microsoft Word 9">
<link rel=Edit-Time-Data href="./SEMAFORI_files/editdata.mso">
<title>Semafori</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Nobody</o:Author>
  <o:LastAuthor>Leonardo Jelenkoviæ</o:LastAuthor>
  <o:Revision>11</o:Revision>
  <o:TotalTime>80</o:TotalTime>
  <o:LastPrinted>2002-02-28T10:16:00Z</o:LastPrinted>
  <o:Created>2002-02-27T16:55:00Z</o:Created>
  <o:LastSaved>2002-02-28T10:16:00Z</o:LastSaved>
  <o:Pages>4</o:Pages>
  <o:Words>1445</o:Words>
  <o:Characters>8239</o:Characters>
  <o:Company>FER Zagreb</o:Company>
  <o:Lines>68</o:Lines>
  <o:Paragraphs>16</o:Paragraphs>
  <o:CharactersWithSpaces>10118</o:CharactersWithSpaces>
  <o:Version>9.3821</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:DrawingGridHorizontalSpacing>6 pt</w:DrawingGridHorizontalSpacing>
  <w:DrawingGridVerticalSpacing>6 pt</w:DrawingGridVerticalSpacing>
  <w:DisplayVerticalDrawingGridEvery>0</w:DisplayVerticalDrawingGridEvery>
  <w:UseMarginsForDrawingGridOrigin/>
  <w:Compatibility>
   <w:SpaceForUL/>
   <w:BalanceSingleByteDoubleByteWidth/>
   <w:DoNotLeaveBackslashAlone/>
   <w:ULTrailSpace/>
   <w:DoNotExpandShiftReturn/>
   <w:UsePrinterMetrics/>
   <w:WW6BorderRules/>
   <w:FootnoteLayoutLikeWW8/>
   <w:ShapeLayoutLikeWW8/>
   <w:AlignTablesRowByRow/>
   <w:ForgetLastTabAlignment/>
   <w:AutoSpaceLikeWord95/>
   <w:LayoutRawTableWidth/>
   <w:LayoutTableRowsApart/>
   <w:UseWord97LineBreakingRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
 </w:WordDocument>
</xml><![endif]-->
<style>
<!--
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:HR; margin-left:0cm; margin-right:0cm; margin-top:0cm}
h1
	{margin-right:0cm;
	mso-margin-top-alt:auto;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	mso-outline-level:1;
	font-size:24.0pt;
	font-family:"Times New Roman";
	mso-font-kerning:18.0pt;
	mso-ansi-language:EN-GB;
	font-weight:bold;}
h2
	{margin-right:0cm;
	mso-margin-top-alt:auto;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	mso-outline-level:2;
	font-size:18.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:EN-GB;
	font-weight:bold;}
h3
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:HR;
	font-weight:bold;
	mso-bidi-font-weight:normal;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 207.65pt right 415.3pt;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:HR;}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 207.65pt right 415.3pt;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:HR;}
p
	{margin-right:0cm;
	mso-margin-top-alt:auto;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:HR;}
pre
	{margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Courier New";
	mso-ansi-language:EN-GB;}
tt
	{mso-ascii-font-family:"Courier New";
	mso-fareast-font-family:"Courier New";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Courier New";}
p.Tekst10, li.Tekst10, div.Tekst10
	{mso-style-name:Tekst10;
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-indent:18.0pt;
	mso-pagination:widow-orphan;
	mso-hyphenate:none;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	letter-spacing:-.15pt;
	mso-ansi-language:HR;}
p.Tekst, li.Tekst, div.Tekst
	{mso-style-name:Tekst;
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-indent:18.0pt;
	mso-pagination:widow-orphan;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:EN-GB;}
p.Nastavak, li.Nastavak, div.Nastavak
	{mso-style-name:Nastavak;
	mso-style-next:Tekst;
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	mso-pagination:widow-orphan;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:EN-GB;}
p.Razmak, li.Razmak, div.Razmak
	{mso-style-name:Razmak;
	mso-style-parent:Nastavak;
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	mso-pagination:widow-orphan;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:EN-GB;}
p.Polurazmak, li.Polurazmak, div.Polurazmak
	{mso-style-name:Polurazmak;
	mso-style-parent:Razmak;
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	mso-pagination:widow-orphan;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:6.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:EN-GB;}
p.Podnaslov, li.Podnaslov, div.Podnaslov
	{mso-style-name:Podnaslov;
	mso-style-next:Nastavak;
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:0cm;
	text-align:justify;
	mso-pagination:none;
	page-break-after:avoid;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:EN-GB;
	font-weight:bold;
	mso-bidi-font-weight:normal;}
p.Naslov, li.Naslov, div.Naslov
	{mso-style-name:Naslov;
	mso-style-parent:Nastavak;
	mso-style-next:Podnaslov;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:0cm;
	text-align:center;
	page-break-before:always;
	mso-pagination:none;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:16.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:EN-GB;
	font-weight:bold;
	mso-bidi-font-weight:normal;}
p.Kod, li.Kod, div.Kod
	{mso-style-name:Kod;
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:18.0pt 36.0pt 54.0pt 72.0pt 90.0pt;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";
	mso-ansi-language:EN-GB;}
p.Nastavak10, li.Nastavak10, div.Nastavak10
	{mso-style-name:Nastavak10;
	mso-style-next:Tekst10;
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	mso-pagination:widow-orphan;
	mso-hyphenate:none;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	letter-spacing:-.15pt;
	mso-ansi-language:HR;}
p.Malipodnaslov, li.Malipodnaslov, div.Malipodnaslov
	{mso-style-name:"Mali podnaslov";
	mso-style-parent:Podnaslov;
	mso-style-next:Nastavak;
	margin-top:6.0pt;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:0cm;
	text-align:justify;
	mso-pagination:none;
	page-break-after:avoid;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:EN-GB;
	font-weight:bold;
	mso-bidi-font-weight:normal;}
p.Deklaracija, li.Deklaracija, div.Deklaracija
	{mso-style-name:Deklaracija;
	mso-style-parent:Kod;
	mso-style-next:Nastavak;
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";
	mso-ansi-language:EN-GB;}
p.Naredba, li.Naredba, div.Naredba
	{mso-style-name:Naredba;
	mso-style-next:Nastavak;
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:center;
	mso-pagination:widow-orphan;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";
	mso-ansi-language:EN-GB;}
p.Nabrajanje, li.Nabrajanje, div.Nabrajanje
	{mso-style-name:Nabrajanje;
	mso-style-parent:Tekst;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:18.0pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-indent:-18.0pt;
	mso-pagination:widow-orphan;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:EN-GB;}
p.Podnaslov-Tekst, li.Podnaslov-Tekst, div.Podnaslov-Tekst
	{mso-style-name:Podnaslov-Tekst;
	mso-style-next:Tekst;
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:6.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:EN-GB;}
p.Tekst-Podnaslov, li.Tekst-Podnaslov, div.Tekst-Podnaslov
	{mso-style-name:Tekst-Podnaslov;
	mso-style-next:Podnaslov;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:EN-GB;}
p.Uvuceno1, li.Uvuceno1, div.Uvuceno1
	{mso-style-name:"Uvuceno 1";
	mso-style-parent:Tekst;
	mso-style-next:Polurazmak;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:18.0pt;
	margin-bottom:.0001pt;
	text-align:justify;
	mso-pagination:widow-orphan;
	mso-layout-grid-align:none;
	punctuation-wrap:simple;
	text-autospace:none;
	font-size:12.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:EN-GB;}
 /* Page Definitions */
@page
	{mso-facing-pages:yes;}
@page Section1
	{size:595.45pt 841.7pt;
	margin:72.0pt 72.0pt 72.0pt 72.0pt;
	mso-header-margin:36.0pt;
	mso-footer-margin:36.0pt;
	mso-even-footer:url("./SEMAFORI_files/header.htm") ef1;
	mso-footer:url("./SEMAFORI_files/header.htm") f1;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
@list l0
	{mso-list-id:1211570383;
	mso-list-type:hybrid;
	mso-list-template-ids:201610602 680557696 -560065128 -679572640 2060224694 836821554 737149030 -1830810278 -1870215654 1587963632;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-GB style='tab-interval:36.0pt'>

<div class=Section1>

<h1>Sinkronizacijski mehanizmi</h1>


<div class=MsoNormal align=center style='text-align:center'><span lang=HR>

<hr size=1 width="100%" align=center>

</span></div>


<p>Sinkronizacijske mehanizme podijeliti æemo na one koji služe za sinhronizaciju procesa
te na one koji služe za sinkronizaciju dretvi.&nbsp;</p>


<h2>1. Sinkronizacija procesa semaforima</h2>


<p>Sinkronizacija procesa se uglavnom obavlja semaforima. Ostali mehanizmi (èija
primarna namjena nije sinkronizacija, poput redova poruka, cjevovoda, i sl.)
rijetko se koriste za sinkronizaciju procesa. Semafori se takoðer mogu koristiti i kod dretvi (ima i 
posebnih semafora za dretve), ali se kod dretvi najèešæe koriste mehanizmi 
meðusobnog iskljuèivanja korištenjem tzv. mutexa te uvjetnih varijabli.</p>


<p><span lang=HR>Semafor je mehanizam koji spreèava da dva ili više procesa
pristupaju zajednièkom sredstvu istovremeno. Binarni semafor ima dva stanja:
propusno i nepropusno. Opæi semafor ima beskonaèan broj stanja (ili barem vrlo
velik). To je brojaè koji se smanjuje za jedan kada se zahtijeva semafor, a
poveæava se za jedan kada se oslobaða. Ako je na nuli, a proces zahtijeva
semafor, tada taj proces mora èekati dok drugi proces ne poveæa vrijednost
semafora. Semafor u UNIX-u (System V) ne može imati negativnu vrijednost iako
su teoretski ostvarivi i semafori kod kojih bi bile dozvoljene i negativne
vrijednosti. Upotreba semafora se obièno razmatra kroz dvije jednostavne
operacije: &quot;dohvati&quot; i &quot;otpusti&quot; (<i>acquire</i> i <i>release</i>)
ili &quot;èekaj&quot; i &quot;postavi&quot; (<i>wait</i> - <i>signal</i>,
odnosno, izvorno iz nizozemskog: P i V).</span></p>

<h3><font size="4">Semafori u UNIX-u</font></h3>

<p><span lang=HR>Pozivi za korištenje semafora u UNIX-u su daleko od
jednostavnosti operacija dohvati i otpusti. Dapaèe, to su izuzetno složeni
mehanizmi (vidi: </span><tt><span lang=HR
style='font-size:10.0pt;font-family:"Courier New"'>man semget</span></tt><span
lang=HR>, </span><tt><span lang=HR style='font-size:10.0pt;font-family:"Courier New"'>man
semop</span></tt><span lang=HR>, </span><tt><span lang=HR style='font-size:
10.0pt;font-family:"Courier New"'>man semctl</span></tt><span lang=HR>). Zbog
toga æemo se ogranièiti samo na dio funkcionalnosti poziva za rad sa semaforima
koji je dovoljan za veæinu primjena.</span></p>

<h3><span lang=HR>Dobavljanje semafora</span></h3>

<p><span lang=HR>Semafori se dobavljaju sustavskim pozivom <i>semget</i> slièno
kao i segment zajednièkog spremnika:</span></p>

<pre>int semget(key_t key, int nsems, int flags) ;</pre>

<p><span lang=HR>Ovisno o parametru 'key', ovaj sustavski poziv ili dohvaæa 
postojeæi skup semafora (npr. ako ga je vec stvorio neki drugi proces) ili 
stvara novi skup semafora. Novi skup sa ukupno <i>nsem</i>
semafora æe biti stvoren ako se za kljuè upotrijebi </span><tt><span lang=HR
style='font-size:10.0pt;font-family:"Courier New"'>IPC_PRIVATE</span></tt><span
lang=HR>. U devet najnižih bitova <i>flags</i> se stavljaju dozvole pristupa. <i>semget</i>
vraæa identifikacijski broj skupa semafora ili -1 u sluèaju greške. Redni brojevi semafora u skupu poèinju od nule. Zbog
jednostavnosti bilo bi dobro imati uvijek samo po jedan semafor u skupu. Meðutim,
kao i kod zajednièkog spremnika, ukupan broj skupova semafora u sustavu je
ogranièen. Zbog velikog broja korisnika taj je broj lako premašiti, pa je
poželjno sve potrebne semafore uvijek dobavljati odjednom, tj. u jednom skupu.</span></p>

<h3><span lang=HR>Postavljanje poèetne vrijednosti semafora</span></h3>

<p><span lang=HR>Kada se stvara novi skup semafora, vrijednosti svih semafora u
skupu se postavljaju na 0. Ova vrijednost se može promijeniti sustavskim
pozivom <i>semctl</i>, ali to je samo jedna od brojnih operacija koje on
obavlja. Za upravljanje stanjem semafora (npr. postavljanje poèetne vrijednosti) 
koristi se podatkovna struktura 'semun':</span></p>

<pre>union semun {</pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>int val;</pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>struct semid_ds *buf;</pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>unsigned short *array;</pre><pre>};</pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#FF0000">int semctl(int semid, int semnum, int cmd, union semun *arg) ; //Solaris</font></pre>

<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#FF0000">int semctl(int semid, int semnum, int cmd, union semun arg) ;  //Ostali, više/manje</font></pre>

<p><i><span lang=HR>semid</span></i><span lang=HR> je uvijek identifikacijski
broj skupa semafora. Vrijednost semafora se može postaviti na dva naèina:</span></p>

<ol start=1 type=1>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo1;tab-stops:list 36.0pt'><font size="3">
	<span lang=HR>Ako se kao <i>semnum</i> navede redni broj semafora u skupu, 
	kao <i>cmd</i> navede </span><tt><span style="font-family: Courier New">
	SETVAL</span></tt><span lang=HR>, a u strukturi 'arg' postavi nenegativan 
	cijeli broj u varijablu <i>arg.val</i>, postavit ce se vrijednost zadanog 
	semafora.</span></font></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo1;tab-stops:list 36.0pt'><span lang=HR>
 <font size="3">Ako je <i>cmd</i> </font>
     </span><font size="3"><tt><span lang=HR style='font-family:"Courier New"'>SETALL</span></tt></font><span
     lang=HR><font size="3">, a <i>arg</i> kazaljka na niz kratkih cijelih brojeva bez
     predznaka (<i>arg.array</i>), postavljaju se svi semafori u skupu na
     vrijednosti iz danog niza. </font> </span></li>
</ol>

<p><i><span lang=HR>semctl</span></i><span lang=HR> pozvan na ovaj naèin vraæa
0 ako je sve u redu ili -1 u sluèaju greške (na primjer, vrijednost na koju
treba postaviti semafor je prevelika ili negativna).</span></p>

<h3><span lang=HR>Uništavanje semafora</span></h3>

<p><span lang=HR>Skup semafora treba uništiti nakon upotrebe jer u protivnom
ostaje kao trajno zauzeto sredstvo u sustavu. Uništavanje semafora takoðer se
provodi sustavskim pozivom <i>semctl</i>. <i>semid</i> je identifikacijski broj
skupa semafora, a <i>cmd</i> treba biti </span><tt><span lang=HR
style='font-size:10.0pt;font-family:"Courier New"'>IPC_RMID</span></tt><span
lang=HR>. Ostali argumenti nisu bitni.</span></p>

<h3><span lang=HR>Operacije sa semaforima</span></h3>
<p>Za rad sa semaforima koristi se sustavski poziv <i>semop</i> u kombinaciji sa 
podatkovnom strukturom <i>sembuf</i>:</p>

<h3><span style="font-weight: 400"><font size="2" face="Courier New">struct sembuf {</font></span></h3>

<pre><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>short sem_num;</pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>short sem_op;</pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>short sem_flg;</pre><pre>};</pre><pre>int semop(int semid, struct sembuf (*sops)[], int nsops) ;</pre>

<p><i><span lang=HR>semop</span></i><span lang=HR> se može upotrijebiti za
nedjeljivo izvoðenje niza operacija na skupu semafora. Meðutim, najèešæe je
sasvim dovoljno izvesti jednu operaciju u jednom pozivu. U tom sluèaju, <i>semid</i>
je identifikacijski broj skupa semafora, <i>nsops</i> je 1, a <i>sops</i> je
kazaljka na strukturu koja opisuje traženu operaciju. Unutar te strukture, <i>sem_num</i>
je redni broj semafora u skupu, <i>sem_op</i> je tražena operacija koju dodatno
opisuje i <i>sem_flg</i>.</span></p>

<p><span lang=HR>Za uobièajeno korištenje semafora dovoljne su dvije vrste
operacija: poveæavanje vrijednosti semafora (<i>sem_op</i> je pozitivan) i
smanjivanje vrijednosti semafora (<i>sem_op</i> je negativan). U oba sluèaja, <i>sem_flg</i>
treba biti 0. <i>semop</i> vraæa rezultat 0 ako je sve u redu, ili -1 u sluèaju
greške.</span></p>

<p><span lang=HR>Smanjivanje vrijednosti semafora odgovara operaciji
&quot;èekaj&quot;. Ukoliko je vrijednost semafora moguæe umanjiti za zadani broj,
a da ne postane negativna, vrijednost se umanjuje, a proces nastavlja rad. U
suprotnom sluèaju, proces èeka dok vrijednost semafora ne postane dovoljno
velika da se umanjivanje može provesti.</span></p>

<p><span lang=HR>Poveæavanje vrijednosti odgovara operaciji
&quot;postavi&quot;. Vrijednost semafora se poveæava za zadani broj, a proces
nastavlja rad. Proces zaustavljen u redu semafora se oslobaða ako je ovim
poveæanjem vrijednost semafora postala dovoljno velika da je on može umanjiti,
a da ipak ne postane negativna.</span></p>

<h3><span lang=HR>Pomoæne funkcije za rad sa semaforima</span></h3>

<p><span lang=HR>Prethodna objašnjenja rada sa semaforima mogu se upotrijebiti
za izradu pomoænih funkcija za rad sa semaforima koje su mnogo jednostavnije za
upotrebu od izravnih sustavskih poziva.</span></p>

<pre>#include &lt;stdio.h&gt;</pre><pre>#include &lt;sys/types.h&gt;</pre><pre>#include &lt;sys/ipc.h&gt;</pre><pre>#include &lt;sys/sem.h&gt;</pre><pre></pre><pre>int SemId;<span style="mso-spacerun: yes">&nbsp;&nbsp; </span>/* <i>identifikacijski broj skupa semafora</i> */</pre><pre></pre><pre>void SemGet(int n)</pre><pre>{<span style="mso-spacerun: yes">&nbsp; </span>/* <i>dobavi skup semafora sa ukupno <b>n</b> semafora</i> */</pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>SemId = semget(IPC_PRIVATE, n, 0600);</pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>if (SemId == -1) {</pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>printf(&quot;Nema semafora!\n&quot;);</pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>exit(1);</pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>}</pre><pre>}</pre><pre></pre><pre>int SemSetVal(int SemNum, int SemVal)</pre><pre>{<span style="mso-spacerun: yes">&nbsp; </span>/* <i>postavi vrijednost semafora <b>SemNum</b> na <b>SemVal</b></i> */</pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>return semctl(SemId, SemNum, SETVAL, <font color="#FF0000">SemVal</font>);</pre><pre>}</pre><pre></pre><pre>int SemOp(int SemNum, int SemOp)</pre><pre>{<span style="mso-spacerun: yes">&nbsp; </span>/* <i>obavi operaciju <b>SemOp</b> sa semaforom <b>SemNum</b></i> */</pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>struct sembuf SemBuf;</pre><pre></pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>SemBuf.sem_num = SemNum;</pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>SemBuf.sem_op<span style="mso-spacerun: yes">&nbsp; </span>= SemOp;</pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>SemBuf.sem_flg = 0;</pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>return semop(SemId, &amp; SemBuf, 1);</pre><pre>}</pre><pre></pre><pre>void SemRemove(void)</pre><pre>{<span style="mso-spacerun: yes">&nbsp; </span>/* <i>uništi skup semafora</i> */</pre><pre><span style="mso-spacerun: yes">&nbsp;&nbsp; </span>(void) semctl(SemId, 0, IPC_RMID, 0);</pre><pre>}</pre>

<p><a href="visezadacnirad.html#ZAJEDNICKI_ADRESNI_PROSTOR">ZAJEDNIÈKI ADRESNI 
PROSTOR</a></p>

<hr>

<h2>2. Sinkronizacija dretvi</h2>

<p ALIGN="JUSTIFY">Istovremeni pristup podacima od strane više dretvi se ponekad ne smije dopustiti. To su situacije u kojima dretve koriste zajednièke varijable, a èija bi istovremena
uporaba izazvala greške. Takvi se kritièni odsjeèci programa zaštiæuju meðusobnim iskljuèivanjem. Kod korištenja zajednièkih podataka treba takoðer uzeti u obzir da promjena koju uzrokuje jedna dretva ne mora baš istog trenutka biti
vidljiva svim ostalim dretvama. Odnosno, zbog toga što procesori koriste vlastite priruène
spremnike, promjena podatka se privremeno može obaviti samo lokalno, a ažuriranje
glavnog spremnika može se obaviti tek kasnije. Takvi se dijelovi programa takoðer zaštiæuju.</p>

<p ALIGN="JUSTIFY">UNIX operacijski sustav (<i>SUN Solaris, a i Linux</i>) omoguæuje
sljedeæe naèine sinkronizacije meðu dretvama: <i>meðusobno iskljuèivanje, uvjetne
varijable </i>i<i> semafori</i>. Kada je potrebno zaštititi neke dijelove 
programa od istovremenog korištenja više dretvi (kritièni odsjeèci), tada se 
koriste funkcije meðusobnog iskljuèivanja, odnosno, dijelovi programa se 
zakljuèavaju pomoæu kontrolnih varijabli - kljuèeva. 
Inicijalizacija kljuèeva se obavlja funkcijom <font FACE="Courier New" SIZE="2">
pthread_mutex_init</font><font FACE="Times New Roman">, zakljuèavanje funkcijom </font>
<font FACE="Courier New" SIZE="2">
pthread_mutex_lock</font>, a otkljuèavanje funkcijom
<font FACE="Courier New" SIZE="2">
pthread_mutex_unlock</font> (<i>Solaris</i> ima i svoje vlastite funkcije za te 
operacije koje nemaju prefix &quot;pthread_&quot;)</p>
<p ALIGN="JUSTIFY"><font FACE="Courier New" SIZE="2">int pthread_mutex_init(pthread_mutex_t 
*kljuè, const pthread_mutexattr_t *attr);<br>
int pthread_mutex_lock(pthread_mutex_t *kljuè);<br>
int pthread_mutex_unlock(pthread_mutex_t *kljuè);</font></p>
<p ALIGN="JUSTIFY"><font FACE="Courier New" SIZE="2">kljuè</font><font FACE="Times New Roman"> 
pokazuje na varijablu zakljuèavanja, </font><font FACE="Courier New" size="2"> 
attr</font><font FACE="Times New Roman"> </font>definira karakteristike stvorene 
varijable (NULL za pretpostavljene vrijednosti). Sve dretve koje 
pokušaju zakljuèati veæ zakljuèanu varijablu ostaju blokirane na pozivu sve dok 
varijabla ostaje zakljuèana. Kada se varijabla otkljuèa, tada samo jedna dretva 
ulazi u kritièni osjeèak, uz ponovno zakljuèavanje varijable. Zakljuèavanjem 
se smanjuje moguæa istovremenost u izvoðenju skupine dretvi, te je njihova 
upotreba prihvatljiva (obavezna) samo u kritiènim odsjeècima. </p>
<i>
<p ALIGN="JUSTIFY"><b>Uvjetne varijable</b></i> se koriste kada želimo da neka dretva 
zaustavi svoje izvoðenje te èeka da se odreðeni uvjet ispuni, tj. da ga ispuni 
neka druga dretva. Funkcijama za korištenje uvjetnih varijabli obavezno prethodi 
zakljuèavanje, buduæi su uvjetne varijable globalne, tj. zajednièke cijelom procesu.
</p>
<p ALIGN="JUSTIFY">Osnovne funkcije za rukovanje uvjetnim varijablama su<font FACE="Courier New" SIZE="2"> 
pthread_cond_init, pthread_cond_wait, pthread_cond_signal </font><font SIZE="2">i</font><font FACE="Courier New" SIZE="2"> 
pthread_cond_broadcast.</font></p>
<p ALIGN="JUSTIFY"><font FACE="Courier New" SIZE="2">int pthread_cond_init(pthread_cond_t 
*uvjet, const pthread_condattr_t *attr);<br>
int pthread_cond_wait(pthread_cond_t *uvjet, pthread_mutex_t *kljuè);<br>
int pthread_cond_signal(pthread_cond_t *uvjet);<br>
int pthread_cond_broadcast(pthread_cond_t *uvjet);</p>
<p ALIGN="JUSTIFY">uvjet</font> je kazaljka na uvjetnu varijablu,
<font FACE="Courier New" SIZE="2">kljuè</font> jest kazaljka na varijablu 
zakljuèavanja, <font face="Courier New" size="2">attr</font> odefinira 
karakteristike stvorene varijable (NULL za pretpostavljene vrijednosti). Pozivom <font FACE="Courier New" SIZE="2">
pthread_cond_wait</font> pozivajuæa dretva se 
postavlja u stanje èekanja tj. premješta ju se u red
<font face="Courier New" size="2">uvjet</font> i istovremeno se otljuèava
<font face="Courier New" size="2">kljuè</font>. Èekanje te dretve završava neka druga dretva pozivima
<font FACE="Courier New" SIZE="2">pthread_cond_signal</font> ili
<font FACE="Courier New" SIZE="2">pthread_cond_broadcast</font>. Po primitku &quot;signala&quot; 
dretva prije nastavka rada najprije mora ponovno zakljuèati
<font face="Courier New" size="2">kljuè</font>. Poziv
<font FACE="Courier New" SIZE="2">pthread_cond_signal</font> ispunjuje uvjet za 
nastavaka samo jedne dretve iz reda èekanja na istu uvjetnu varijablu, dok poziv
<font FACE="Courier New" SIZE="2">pthread_cond_broadcast</font> omoguæuje svim takvim 
dretvama nastavak izvoðenja. Ako niti jedna dretva nije bila blokirana na 
uvjetnoj varijabli prilikom poziva <font FACE="Courier New" SIZE="2">pthread_cond_signal</font><i>
</i>i <font FACE="Courier New" SIZE="2">pthread_cond_broadcast</font>, onda ovi pozivi 
nemaju nikakav uèinak, tj. ako veæ u slijedeæem trenutku neka dretva pozove <font FACE="Courier New" SIZE="2">
pthread_cond_wait</font> ona ostaje blokirana.
Uvjetnim varijablama moguæe je ostvariti sustav 
monitora - mehanizma kojim je moguæe istovremeno provjeriti više uvjeta (zauzeti 
resurse) potrebnih za napredovanje dretve.</p>
<p ALIGN="JUSTIFY">Poziv <font FACE="Courier New" SIZE="2">pthread_cond_wait(uvjet, 
kljuè)</font> može se shvatiti u dva koraka: u prvom se otkljuèava
<font face="Courier New" size="2">kljuè</font> i dretva pomièe u red
<font face="Courier New" size="2">uvjet</font>; u drugom, nakon primitka signala 
se mora ponovno zakljuèati <font size="2" face="Courier New">kljuè</font>. Tj. 
mogli bi reæi da funkcija izgleda:</p>
<p ALIGN="JUSTIFY"><font FACE="Courier New" SIZE="2">pthread_cond_wait(uvjet, kljuè) {<br>
&nbsp;&nbsp; oslobodi(kljuè); //funkcionalno skoro isto što i mutex_unlock()<br>
&nbsp;&nbsp; uvrsti_u_red_uvjeta(uvjet);<br>
<br>
&nbsp;&nbsp; zauzmi(kljuè); //funkcionalno isto što i mutex_lock()<br>
}</font></p>
<p><i><b>Monitor</b></i> se sastoji od skupa procedura i strukture podataka nad kojima
procedure djeluju i koje nisu vidljive izvan monitora. Procedure se ne smiju
izvoditi paralelno. Unutar monitora ispituje se
uvjet koji utjeèe na odvijanje zadatka. Ukoliko je uvjet ispunjen, zadatak
zauzima sredstva i obavlja potrebne akcije nad njima unutar monitora. Po
završetku oslobaða sredstva te dozvoljava drugom zadatku ulazak u monitor
te izlazi iz monitora. Ukoliko po ulasku u monitor uvjet nije ispunjen
tada zadatak odlazi u red èekanja na taj uvjet, tj. prividno napušta monitor.
</p>
<p>Ostvarenje monitora u višedretvenom programu prilièno je jednostavna buduæi
na raspolaganju stoje funkcije meðusobnog iskljuèavanja èime se jednostavno
postiže da samo jedna dretva ulazi u monitor, te funkcije za rukovanje
uvjetnim varijablama koje služe za ostvarenje reda uvjeta. Ostvarenje monitora koji zauzima sredstva 
<font face="Courier New" size="2">p</font> i <font face="Courier New" size="2">q</font> prikazan je u nastavku:<br>
</p>

  <div align="justify">
    <pre>void primjer_monitorske_funkcije_koja_ispituje_uvjet(cond_t *uvjet){ 
   pthread_mutex_lock(&amp;monitor);
   while(p==0 || q==0) 
      pthread_cond_wait(uvjet,&amp;monitor); 
   p=q=0; 
   pthread_mutex_unlock(&amp;monitor); 
} 
</pre>
</div>
<div align="justify">
  <pre>void primjer_monitorske_funkcije_koja_oslobadja_iz_reda_uvjeta(cond_t *uvjet){ 
   pthread_mutex_lock(&amp;monitor); 
   p=q=1; 
   pthread_cond_broadcast(uvjet); 
   pthread_mutex_unlock(&amp;monitor); 
} 
</pre>
</div>
<i>
<p ALIGN="JUSTIFY"><b>Semafori</b></i> se obièno upotrebljavaju za pristup <i> ogranièenim</i> 
sredstvima od strane veæeg broja korisnika (dretvi), tj. služe kao brojaèi dogaðaja. Osnovne funkcije za rad sa 
semaforima u višedretvenom programu su: <font FACE="Courier New" SIZE="2">
sem_init, sem_post</font><i> </i>i<i> </i><font FACE="Courier New" SIZE="2">
sem_wait</font>.</p>
<p ALIGN="JUSTIFY"><font FACE="Courier New" SIZE="2">int sem_init(sem_t *sem, 
int mprocesi, unsigned int koliko);<br>
int sem_post(sem_t *sem);<br>
int sem_wait(sem_t *sem);</font></p>
<p ALIGN="JUSTIFY"><font FACE="Courier New" SIZE="2">sem</font> je pokazivaè na 
varijablu semafora, <font FACE="Courier New" SIZE="2">koliko</font> je broj na 
koji se postavi semafor, mprocesi oznaèava je li semafor predviðen za 
sinkronizaciju dretvi istog procesa (0) ili dretvi razlièitih procesa (nešto 
razlièito od nule). Funkcija <font FACE="Courier New" SIZE="2">sem_post</font> 
jedinièno poveæava semafor. Funkcija <font FACE="Courier New" SIZE="2">sem_wait</font> 
smanjuje vrijednost semafora za jedan, ako je vrijednost semafora veæa od nule, 
u protivnom èeka dok se vrijednost ne poveæa.</p>

</div>

<P ALIGN="JUSTIFY">Stranice (manual) POSIX dretvi u kojima su detaljno opisane 
funkcije za rad s dretvama <FONT FACE="Courier New" SIZE=2> <I>pthread</I>: 
<a href="pthread/pthread.htm">pthread</a>,
<a href="pthread/pthread_create.htm">pthread_create</a>, 
<a href="pthread/pthread_exit.htm">pthread_exit</a>, 
<a href="pthread/pthread_detach.htm">pthread_detach</a>, 
<a href="pthread/pthread_join.htm">pthread_join</a>, 
<a href="pthread/pthread_mutex_init.htm">pthread_mutex_init</a>, 
<a href="pthread/pthread_mutex_lock.htm">pthread_mutex_lock</a>, 
<a href="pthread/pthread_mutex_unlock.htm">pthread_mutex_unlock</a>, 
<a href="pthread/pthread_mutex_destroy.htm">pthread_mutex_destroy</a>, 
<a href="pthread/pthread_cond_init.htm">pthread_cond_init</a>, 
<a href="pthread/pthread_cond_wait.htm">pthread_cond_wait</a>, 
<a href="pthread/pthread_cond_signal.htm">pthread_cond_signal</a>, 
<a href="pthread/sem_init.htm">sem_init</a>, <a href="pthread/sem_wait.htm">sem_wait</a>,
<a href="pthread/sem_post.htm">sem_post</a>, <a href="pthread/sem_destroy.htm">sem_destroy</a>...</FONT></P>

</body>

</html>